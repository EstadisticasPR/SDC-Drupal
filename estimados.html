<div class="container" ng-app="countryApp" ng-controller="CountryCtrl">
<table border="0" cellpadding="20" cellspacing="20" width="100%">
	<tbody>
		<tr>
			<td>
			<div align="left">
			<div class="form-group"><select class="selectpicker" data-actions-box="true" data-done-button="true" data-selected-text-format="count&gt;3" id="municipios" multiple="multiple" name="municipios[]" ng-click="ShowMe();" size="10"><option value="Puerto Rico">Puerto Rico</option><option value="Adjuntas">Adjuntas</option><option value="Aguada">Aguada</option><option value="Aguadilla">Aguadilla</option><option value="Aguas Buenas">Aguas Buenas</option><option value="Aibonito">Aibonito</option><option value="Añasco">Añasco</option><option value="Arecibo">Arecibo</option><option value="Arroyo">Arroyo</option><option value="Barceloneta">Barceloneta</option><option value="Barranquitas">Barranquitas</option><option value="Bayamón">Bayamón</option><option value="Cabo Rojo">Cabo Rojo</option><option value="Caguas">Caguas</option><option value="Camuy">Camuy</option><option value="Canóvanas">Canóvanas</option><option value="Carolina">Carolina</option><option value="Cataño">Cataño</option><option value="Cayey">Cayey</option><option value="Ceiba">Ceiba</option><option value="Ciales">Ciales</option><option value="Cidra">Cidra</option><option value="Coamo">Coamo</option><option value="Comerio">Comerio</option><option value="Corozal">Corozal</option><option value="Culebra">Culebra</option><option value="Dorado">Dorado</option><option value="Fajardo">Fajardo</option><option value="Florida">Florida</option><option value="Guánica">Guánica</option><option value="Guayama">Guayama</option><option value="Guayanilla">Guayanilla</option><option value="Guaynabo">Guaynabo</option><option value="Gurabo">Gurabo</option><option value="Hatillo">Hatillo</option><option value="Hormigueros">Hormigueros</option><option value="Humacao">Humacao</option><option value="Isabela">Isabela</option><option value="Jayuya">Jayuya</option><option value="Juana Díaz">Juana Díaz</option><option value="Juncos">Juncos</option><option value="Lajas">Lajas</option><option value="Lares">Lares</option><option value="Las Marías">Las Marías</option><option value="Las Piedras">Las Piedras</option><option value="Loíza">Loíza</option><option value="Luquillo">Luquillo</option><option value="Manatí">Manatí</option><option value="Maricao">Maricao</option><option value="Maunabo">Maunabo</option><option value="Mayagüez">Mayagüez</option><option value="Moca">Moca</option><option value="Morovis">Morovis</option><option value="Naguabo">Naguabo</option><option value="Naranjito">Naranjito</option><option value="Orocovis">Orocovis</option><option value="Patillas">Patillas</option><option value="Peñuelas">Peñuelas</option><option value="Ponce">Ponce</option><option value="Quebradillas">Quebradillas</option><option value="Rincón">Rincón</option><option value="Río Grande">Río Grande</option><option value="Sabana Grande">Sabana Grande</option><option value="Salinas">Salinas</option><option value="San Germán">San Germán</option><option value="San Juan">San Juan</option><option value="San Lorenzo">San Lorenzo</option><option value="San Sebastián">San Sebastián</option><option value="Santa Isabel">Santa Isabel</option><option value="Toa Alta">Toa Alta</option><option value="Toa Baja">Toa Baja</option><option value="Trujillo Alto">Trujillo Alto</option><option value="Utuado">Utuado</option><option value="Vega Alta">Vega Alta</option><option value="Vega Baja">Vega Baja</option><option value="Vieques">Vieques</option><option value="Villalba">Villalba</option><option value="Yabucoa">Yabucoa</option><option value="Yauco">Yauco</option> </select></div>
			</div>
			</td>
		</tr>
		<tr>
			<td>
			<div id="chart1">&nbsp;</div>
			</td>
		</tr>
		<tr>
			<td>&nbsp;
			<div><b>Fuente: Estimaciones intercensales poblacionales, Junta de Planificación, 1950-2000;<br />
			Intercensal Population Estimates, U.S. Census Bureau, 2000-10; Annual Population Estimates (Vintage 2014), 2010-14.</b>
			<h6>Notas:<br />
			1) El municipio de Canóvanas se constituyó en 1970, por lo cual no fue incorporado en los estimados anuales poblacionales hasta después de que se realizó el Censo 1980.<br />
			2) El municipio de Florida se constituyó en 1971, por lo cual no fue incorporado en los estimados anuales poblacionales hasta después de que se realizó el Censo 1980.<br />
			3) Las estimaciones intercensales para las decadas de 1950-60, 1960-70 y 1970-80 se basan en interpolaciones lineales.<br />
			4) Las estimaciones intercensales para las decadas de 1980-90 y 1990-2000 se basan en interpolaciones exponenciales.<br />
			5) Para mas informacion sobre la metodologia utilizada para los estimados intercensales de la decada 2000-10, ver: <a href="http://www.census.gov/popest/methodology/2000-2010_Intercensal_Estimates_Methodology.pdf"> http://www.census.gov/popest/methodology/2000-2010_Intercensal_Estimates_Methodology.pdf.</a><br />
			6) Para mas información sobre la metodología utilizada para los estimados anuales poblacionales para la decada 2010-20, ver: <a href="http://www.census.gov/popest/">http://www.census.gov/popest/.</a></h6>
			</div>
			</td>
		</tr>
	</tbody>
</table>
</div>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.3/css/bootstrap-select.min.css" rel="stylesheet" type="text/css" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css" rel="stylesheet" type="text/css" /><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js" ></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.1/angular.min.js" ></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/js/bootstrap.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.3/js/bootstrap-select.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script><script type="text/javascript"src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js"></script><script type="text/javascript">
                                        $(function () {
                                            $('.selectpicker').on('change', function () {
                                               angular.element(document.getElementById('municipios')).scope().ShowMe();
                                               
                                            });
                                           
                                        });
                                        var countryApp = angular.module('countryApp', []);
                                        countryApp.controller('CountryCtrl', function ($scope, $http) {
                                            $http.get('https://www.indicadores.pr/resource/8ey7-awsw.csv').success(function (data) {
                                                $(".municipios").attr('checked', false);

                                                $scope.counties = $scope.pivotMe($scope.csvToArray(data));

                                                $scope.selectedMunicipios = ['Año', 'Puerto Rico'];
                                                $scope.result = {};
                                                angular.forEach($scope.selectedMunicipios, function (key) {
                                                    $scope.result[key] = $scope.counties[key];
                                                });
                                                $scope.yearList = [];
                                                for (i = 1950; i <= new Date().getFullYear(); i += 10) {
                                                    $scope.yearList.push(i);
                                                }
                                                $scope.config = {};
                                                $scope.config.bindto = "#chart1";
                                                $scope.config.size_height = 500;
                                                $scope.config.data = {};
                                                $scope.config.data.json = $scope.result;
                                                $scope.config.data.mimeType = "json";
                                                $scope.config.data.x = 'Año';

                                                $scope.config.axis = {};
                                                $scope.config.axis = {
                                                    y: {show: true, tick: {format: d3.format(",")}, label: {text: 'Núm. habitantes'}, min: 0},
                                                    x: {min: 1950, label: 'Año', tick: {values: $scope.yearList}}};
                                                $scope.config.legend_show = true;
                                                $scope.config.oninit = function () {
                                                    $("body").css("cursor", "progress");
                                                };
                                                $scope.config.onrendered = function () {
                                                    $("body").css("cursor", "default");
                                                };
                                                $scope.chart = c3.generate($scope.config);



                                            });
                                            $scope.ShowMe = function () {
                                                $scope.selectedMunicipios = [];
                                                $scope.selectedMunicipios.push("Año");
                                                $("select option:selected").each(function (index, element) {
                                                    $scope.selectedMunicipios.push(element.value);
                                                });
                                                if ($scope.selectedMunicipios.length === 1) {
                                                    $scope.selectedMunicipios.push('Puerto Rico');
                                                }

                                                $scope.result = {};
                                                angular.forEach($scope.selectedMunicipios, function (key) {
                                                    $scope.result[key] = $scope.counties[key];
                                                });

                                                $scope.config.data = {};
                                                $scope.config.data.json = $scope.result;
                                                $scope.config.data.mimeType = "json";
                                                $scope.config.data.x = "Año";
                                                $scope.config.axis = {};
                                                $scope.config.axis = {
                                                    y: {show: true, tick: {format: d3.format(",")}, label: {text: 'Núm. habitantes'}, min: 0},
                                                    x: {min: 1950, label: 'Año', tick: {values: $scope.yearList}}};
                                                $scope.chart = c3.generate($scope.config);

                                            };
                                            $scope.csvToArray = function (csvString) {
                                                var csvArray = []; // The array we're going to build
                                                var csvRows = csvString.split(/\n/); // Break it into rows to start
                                                var csvHeaders = csvRows.shift().split(','); // Take off the first line to get the headers, then split that into an array

                                                // Loop through remaining rows
                                                for (var rowIndex = 0; rowIndex < csvRows.length; ++rowIndex) {// Loop through remaining rows
                                                    var rowArray = csvRows[rowIndex].split(',');
                                                    var rowObject = csvArray[rowIndex] = {}; // Create a new row object to store our data.

                                                    // Then iterate through the remaining properties and use the headers as keys
                                                    for (var propIndex = 0; propIndex < rowArray.length; ++propIndex) {
                                                        var propValue = rowArray[propIndex].replace(/^"|"$/g, ''); // Grab the value from the row array we're looping through...
                                                        var propLabel = csvHeaders[propIndex].replace(/^"|"$/g, ''); // ...also grab the relevant header (the RegExp in both of these removes quotes)
                                                        rowObject[propLabel] = propValue;
                                                    }
                                                }
                                                return  csvArray;
                                            };
                                            $scope.pivotMe = function (arr) {
                                                //var rowLength = arr.length;
                                                var keys = [];
                                                for (row = 0; row < 1; row++) {
                                                    angular.forEach(arr[row], function (value, key) {
                                                        keys.push(key);
                                                    });
                                                }
                                                ;
                                                var mydata = {};
                                                angular.forEach(keys, function (key) {
                                                    mydata[key] = [];
                                                    for (row = 0; row < arr.length - 1; row++) {
                                                        mydata[key].push(arr[row][key]);
                                                    }
                                                    ;
                                                });
                                                return mydata;
                                            };
                                        });
            </script>